<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Metric Staircase Master</title>
    <style>
        :root {
            --primary: #4361ee;
            --success: #2ec4b6;
            --error: #e63946;
            --bg: #f8f9fa;
            --card: #ffffff;
            --text: #212529;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg);
            color: var(--text);
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            margin: 0;
        }

        h1 { margin-bottom: 5px; color: var(--primary); }
        p.subtitle { margin-top: 0; color: #6c757d; }

        /* Container for the app */
        .app-container {
            max-width: 800px;
            width: 100%;
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }

        /* The Staircase Visualizer */
        .staircase-panel {
            background: var(--card);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        .staircase {
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            margin: 20px 0;
            min-width: 600px; /* Ensure it doesn't squish on mobile */
        }

        .step {
            width: 80px;
            height: 80px;
            border-radius: 10px;
            background: #e9ecef;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-weight: bold;
            transition: all 0.3s ease;
            position: relative;
            border: 2px solid transparent;
        }

        .step.active-start { background: #ffeaa7; border-color: #fdcb6e; transform: scale(1.1); }
        .step.active-end { background: #81ecec; border-color: #00cec9; transform: scale(1.1); }
        
        /* Connecting line */
        .connector {
            position: absolute;
            height: 4px;
            background: #dee2e6;
            top: 50%;
            left: 40px;
            right: 40px;
            z-index: -1;
        }

        .step span.prefix { font-size: 1.2rem; }
        .step span.abbr { font-size: 0.9rem; color: #6c757d; }
        .step span.mnemonic { 
            position: absolute; 
            top: -25px; 
            font-size: 0.8rem; 
            color: var(--primary);
            width: 100px;
            text-align: center;
        }

        /* Game Area */
        .game-panel {
            background: var(--card);
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            text-align: center;
        }

        .question-box {
            font-size: 1.5rem;
            margin-bottom: 20px;
        }

        .highlight { font-weight: bold; color: var(--primary); }

        .input-group {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        input[type="number"] {
            padding: 10px 15px;
            font-size: 1.2rem;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            width: 150px;
        }

        button {
            padding: 10px 25px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: transform 0.1s;
        }

        button.check-btn { background-color: var(--primary); color: white; }
        button.check-btn:hover { background-color: #304ffe; }
        button.next-btn { background-color: #6c757d; color: white; display: none; }
        
        /* Feedback Styles */
        .feedback {
            margin-top: 20px;
            padding: 15px;
            border-radius: 8px;
            text-align: left;
            display: none;
        }

        .feedback.correct { background-color: #d1e7dd; color: #0f5132; border: 1px solid #badbcc; }
        .feedback.incorrect { background-color: #f8d7da; color: #842029; border: 1px solid #f5c2c7; }

        .explanation-step { margin: 5px 0; }
        .math-visual { 
            font-family: 'Courier New', Courier, monospace; 
            font-weight: bold; 
            background: rgba(255,255,255,0.5); 
            padding: 2px 5px; 
            border-radius: 4px;
        }

    </style>
</head>
<body>

    <h1>Metric Staircase Master</h1>
    <p class="subtitle">Grade 9 Science & Math Practice</p>

    <div class="app-container">
        
        <div class="staircase-panel">
            <h3>The Metric Layout</h3>
            <div class="staircase" id="staircase">
                <div class="connector"></div>
                </div>
            <p style="text-align: center; font-size: 0.9rem; color: #6c757d;">
                <span style="color:#fdcb6e">● Start</span> &rarr; <span style="color:#00cec9">● End</span>
            </p>
        </div>

        <div class="game-panel">
            <div class="question-box" id="question-text">
                Loading Question...
            </div>
            
            <div class="input-group">
                <input type="number" id="user-answer" placeholder="Enter value" step="any">
                <span id="target-unit-label" style="align-self: center; font-size: 1.2rem; font-weight: bold;"></span>
            </div>

            <button class="check-btn" onclick="checkAnswer()">Check Answer</button>
            <button class="next-btn" onclick="generateQuestion()">Next Question</button>

            <div class="feedback" id="feedback-area"></div>
        </div>
    </div>

    <script>
        // --- DATA STRUCTURE ---
        const units = [
            { name: "Kilo", abbr: "k", power: 3, mnemonic: "King" },
            { name: "Hecto", abbr: "h", power: 2, mnemonic: "Henry" },
            { name: "Deca", abbr: "da", power: 1, mnemonic: "Died" },
            { name: "Base", abbr: "(m/l/g)", power: 0, mnemonic: "By" },
            { name: "Deci", abbr: "d", power: -1, mnemonic: "Drinking" },
            { name: "Centi", abbr: "c", power: -2, mnemonic: "Chocolate" },
            { name: "Milli", abbr: "m", power: -3, mnemonic: "Milk" }
        ];

        // State variables
        let currentStart = 0;
        let currentEnd = 0;
        let currentValue = 0;
        let baseType = "m"; // meters, liters, or grams

        // --- INITIALIZATION ---
        function init() {
            renderStaircase();
            generateQuestion();
        }

        // Render the visual steps
        function renderStaircase() {
            const container = document.getElementById('staircase');
            // clear existing except connector
            container.innerHTML = '<div class="connector"></div>'; 

            units.forEach((unit, index) => {
                const step = document.createElement('div');
                step.className = 'step';
                step.id = `step-${index}`;
                step.innerHTML = `
                    <span class="mnemonic">${unit.mnemonic}</span>
                    <span class="prefix">${unit.name}</span>
                    <span class="abbr">${unit.abbr}</span>
                `;
                container.appendChild(step);
            });
        }

        // --- GAME LOGIC ---
        function generateQuestion() {
            // Reset UI
            document.getElementById('feedback-area').style.display = 'none';
            document.querySelector('.check-btn').style.display = 'inline-block';
            document.querySelector('.next-btn').style.display = 'none';
            document.getElementById('user-answer').value = '';
            
            // Randomize Base Unit (Meters, Grams, Liters)
            const bases = ['m', 'g', 'L'];
            baseType = bases[Math.floor(Math.random() * bases.length)];

            // Pick Start and End indices (ensure they aren't the same)
            currentStart = Math.floor(Math.random() * units.length);
            do {
                currentEnd = Math.floor(Math.random() * units.length);
            } while (currentStart === currentEnd);

            // Generate a simple number (integer or 1 decimal place)
            currentValue = (Math.random() * 100).toFixed(1);
            if (currentValue.endsWith('.0')) currentValue = parseInt(currentValue);
            else currentValue = parseFloat(currentValue);

            // Construct full unit strings (e.g., "km", "mg")
            const startUnitStr = getUnitString(currentStart);
            const endUnitStr = getUnitString(currentEnd);

            // Display
            document.getElementById('question-text').innerHTML = 
                `Convert <span class="highlight">${currentValue} ${startUnitStr}</span> to...`;
            document.getElementById('target-unit-label').innerText = endUnitStr;

            // Update Visuals
            updateVisuals(currentStart, currentEnd);
        }

        function getUnitString(index) {
            if (units[index].name === "Base") return baseType;
            return units[index].abbr + baseType;
        }

        function updateVisuals(start, end) {
            // clear previous highlights
            document.querySelectorAll('.step').forEach(s => {
                s.classList.remove('active-start', 'active-end');
            });
            
            // add new highlights
            document.getElementById(`step-${start}`).classList.add('active-start');
            document.getElementById(`step-${end}`).classList.add('active-end');
        }

        function checkAnswer() {
            const userVal = parseFloat(document.getElementById('user-answer').value);
            
            // Calculate Logic
            // Difference in steps tells us power of 10
            // Start index (e.g., 0 for Kilo) to End index (e.g., 6 for Milli)
            // Steps = End - Start. 
            // If positive, we are going DOWN (Right). If negative, going UP (Left).
            const stepDiff = currentEnd - currentStart; 
            const factor = Math.pow(10, stepDiff);
            
            // Floating point fix for display
            let correctAnswer = currentValue * factor;
            // Round to avoid 3.00000000004 issues
            correctAnswer = parseFloat(correctAnswer.toPrecision(10));

            // Feedback Logic
            const feedbackEl = document.getElementById('feedback-area');
            feedbackEl.style.display = 'block';
            
            const direction = stepDiff > 0 ? "RIGHT (Down)" : "LEFT (Up)";
            const jumps = Math.abs(stepDiff);
            const operation = stepDiff > 0 ? "multiply" : "divide";

            let htmlContent = "";

            if (userVal === correctAnswer) {
                feedbackEl.className = 'feedback correct';
                htmlContent += `<strong>✅ Correct!</strong><br>`;
            } else {
                feedbackEl.className = 'feedback incorrect';
                htmlContent += `<strong>❌ Not quite.</strong> The answer is <strong>${correctAnswer}</strong>.<br>`;
            }

            // The Master Teacher Explanation
            htmlContent += `
                <hr style="opacity:0.2">
                <div class="explanation-step"><strong>1. Compare:</strong> We moved from <strong>${units[currentStart].name}</strong> to <strong>${units[currentEnd].name}</strong>.</div>
                <div class="explanation-step"><strong>2. Count:</strong> That is <span class="math-visual">${jumps} jumps</span> on the staircase.</div>
                <div class="explanation-step"><strong>3. Slide:</strong> Since we moved ${direction}, we move the decimal point <strong>${jumps} spaces to the ${direction.split(' ')[0]}</strong>.</div>
                <div class="explanation-step"><strong>Math:</strong> ${currentValue} × 10<sup>${stepDiff}</sup> = <strong>${correctAnswer}</strong></div>
            `;

            feedbackEl.innerHTML = htmlContent;
            
            document.querySelector('.check-btn').style.display = 'none';
            document.querySelector('.next-btn').style.display = 'inline-block';
        }

        // Initialize on load
        window.onload = init;

    </script>
</body>
</html>
